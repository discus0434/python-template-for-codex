---
name: spec-writer
description: 仕様追加・変更の要請があったら必ず呼び出す技術仕様書作成ガイド。対話で要件を完全に明確化し、モジュール/クラス/関数レベルの実装計画を作る。
license: Complete terms in LICENSE.txt
---

# Spec Writer

## 目的
- 仕様追加・変更の要請を受けたら最初に呼び出し、要件を完全に明確化する。
- 下流エンジニアが迷わず実装できる粒度（モジュール/クラス/関数）まで落とし込む。

## トリガ
- **新規の仕様追加・変更の要請があった直後**
- 規模/影響が不明、または高リスク領域（DB/認証/課金/移行）の可能性がある

## 原則
- 不明点が一つでも残るなら技術仕様書に進まない。
- 前提は置かず、ユーザー合意を必ず取る。
- 1〜2営業日を超える見込みなら分割する。

## 進め方（必須フロー）
1. **要約**: 現在の理解を短く要約し、誤解がないか確認する。
2. **穴埋め**: 質問テンプレで不足を埋める（複数ラウンドOK）。
3. **合意**: 目的/成果物/MVP/ノンゴール/受け入れ条件を箇条書きで提示し合意を得る。
4. **具体化**: 変更対象のファイル/モジュール/クラス/関数/モデル/例外/テストまで落とす。
5. **仕様書化**: `specs/TEMPLATE.md` を雛形とし、具体タスクとして書き込む。

## 質問テンプレ
- 目的/成果物: 何を作るか？完成状態は？
- ユーザー/利用シーン: 誰がいつ使うか？
- MVP/ノンゴール: 今回やらないことは？
- 制約: 期限/依存/実行環境/互換性は？
- 受け入れ条件: 何が満たされれば完了か？
- リスク: 影響が大きい変更はあるか？

## 具体化チェックリスト（粒度の基準）
- 変更対象ファイル（追加/更新/削除）
- モジュール責務と境界（入力/出力/依存）
- クラス/関数（名前/責務/引数/戻り値）
- データモデル（Pydanticのフィールド/型/検証）
- 例外（どの条件で何をraiseするか）
- テスト（正常/異常/境界、対象関数と紐付ける）
- docs更新点（REQUIREMENTS/DESIGN/CHANGELOG）

## 技術仕様書記述の指針
- `specs/TEMPLATE.md` をコピーして記入する。
- タスクには**対象ファイル・クラス・関数名**を含める。
- テスト項目は「どの関数のどの挙動」を検証するかを書く。
- docs更新は「どのドキュメントのどの章」を更新するかまで具体化する。
- docs更新の前に **spec-reviewer** のセルフレビューを行うタスクを含める。

## ミニ例（粒度の目安）
- 追加: `src/app/exporter.py`
  - `ExportRequest`（Pydantic）: `filters: dict[str, str]`, `limit: int`
  - `CsvExporter.export(request: ExportRequest) -> bytes`
  - 例外: フィルタ不正時 `ValueError("invalid filter")`
- 更新: `tests/test_exporter.py`
  - 正常: フィルタ適用後のCSV内容
  - 異常: 不正フィルタで `ValueError`
  - 境界: 0件/1000件

## 完了後
- 実装＋テスト＋docs反映が完了したら、specs/からdocs/archive/に移動。
- 変更概要を `docs/CHANGELOG.md` に追記。
